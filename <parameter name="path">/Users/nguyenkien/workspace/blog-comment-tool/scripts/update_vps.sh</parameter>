<parameter name="content">#!/usr/bin/env bash
set -euo pipefail

# ============================================================
# Blog Comment Tool - VPS Update Script
# Ch·∫°y sau khi ƒë√£ force push l√™n repo m·ªõi
# ============================================================

PROJECT_DIR="${1:-$HOME/blog-comment-tool}"
SERVICE_NAME="blog-comment-worker"

echo "üöÄ Updating Blog Comment Tool on VPS"
echo "================================================"

# 1. Backup tr∆∞·ªõc khi update
echo "üì¶ B∆∞·ªõc 1: Backup..."
BACKUP_DIR="$PROJECT_DIR-backup-$(date +%Y%m%d-%H%M%S)"
cp -r "$PROJECT_DIR" "$BACKUP_DIR"
echo "‚úÖ Backup saved to: $BACKUP_DIR"

# 2. Stop services
echo "‚èπÔ∏è  B∆∞·ªõc 2: Stop services..."
systemctl stop "$SERVICE_NAME" 2>/dev/null || true
echo "‚úÖ Services stopped"

# 3. Pull code m·ªõi
echo "üîÑ B∆∞·ªõc 3: Pull code m·ªõi..."
cd "$PROJECT_DIR"
git fetch origin
git reset --hard origin/main
echo "‚úÖ Code updated"

# 4. Update dependencies
echo "üêç B∆∞·ªõc 4: Update Python dependencies..."
source .venv/bin/activate
pip install -r requirements.txt -q
echo "‚úÖ Dependencies updated"

# 5. Restart services
echo "‚ñ∂Ô∏è  B∆∞·ªõc 5: Restart services..."
systemctl daemon-reload
systemctl start "$SERVICE_NAME"
sleep 3
systemctl status "$SERVICE_NAME" --no-pager

echo ""
echo "================================================"
echo "‚úÖ Update complete!"
echo ""
echo "L·ªánh h·ªØu √≠ch:"
echo "  Xem logs:   journalctl -u $SERVICE_NAME -f"
echo "  Restart:    systemctl restart $SERVICE_NAME"
echo "  Status:     systemctl status $SERVICE_NAME"
echo ""
echo "Backup n·∫±m ·ªü: $BACKUP_DIR"
echo "================================================"
</parameter>
